# Python 机器学习

## 绪论

### 机器学习的定义

机器学习是从人工智能中产生的一个重要学科分支，是实现智能化的关键。

![image-20200528143835739](C:\Users\38004\AppData\Roaming\Typora\typora-user-images\image-20200528143835739.png)

### 基本概念

> 算法分类

![image-20200528150751443](C:\Users\38004\AppData\Roaming\Typora\typora-user-images\image-20200528150751443.png)

* 有监督学习

  * 样本带有标签值，称为监督信号

    训练样本为 (**x**, y), **x**为特征向量，y为标签值

  * 有学习过程，根据训练样本学习，得到模型，然后用于预测

    机器学习模型实现从特征向量到标签值得映射 y = f(x)

  * 按照标签值得类型可以进一步分为两类

    * **分类问题 —— 标签值为整数编号**

      例如手写数字的识别：`十分类问题`

    * **回归问题 —— 标签值为实数** （例如预测一个人的收入）

  * 可以分为`生成模型`与`判别模型`

    | **类别** | **算法**                                                     |
    | -------- | :----------------------------------------------------------- |
    | 生成模型 | 贝叶斯分类器；高斯混合模型；贝叶斯网络；隐马尔可夫模型；受限玻尔兹曼机；生成对抗网络；变分自动编码器 |
    | 判别模型 | 决策树 ； KNN算法； 人工神经网络； 支持向量机； logistic回归； softmax回归；随机森林；boosting算法；条件随机场 |

---



* 无监督学习

  样本没有标签值，没有训练过程，机器学习算法直接对样本进行处理，得到某种结果

  无监督学习算法分类：

  * **聚类问题** —— 无监督分类，将一组样本划分成多个子集

  * **数据降维问题** —— 将向量映射到更低维的空间

    将n维空间中的向量 **x** 通过某种映射函数映射到更低维的m维空间中
    $$
    \boldsymbol y = \phi(\boldsymbol x)  , m\ll n
    $$
    

---



* 半监督学习（介于有监督学习与无监督学习之间）

  有些训练样本有标签值，有些没有标签值，用这些样本进行训练得到模型，然后用于预测。



---

* 强化学习

  模拟人的行为，源自于行为主义心理学，确定在每种状态下要执行的动作，以达到某种目标。



> 过拟合与欠拟合

| 训练集上的表现 | 测试集上的表现 | 结论                                                         | 原因                                                        |
| -------------- | -------------- | ------------------------------------------------------------ | ----------------------------------------------------------- |
| 不好           | 不好           | 欠拟合：也称为欠学习，指模型在训练集上的精度差               | 模型简单 特征数太少                                         |
| 好             | 不好           | 过拟合：也称为过学习，指模型在训练集上表精度高，但在测试集上精度低，泛化性能差 | 模型过于复杂 ；训练样本太少，缺乏代表性；训练样本噪声的干扰 |
| 好             | 好             | 适度拟合                                                     |                                                             |



## 机器学习涉及到的数学基础

* 导数

* 向量与矩阵

  * 向量的范数：

  $$
  \left | \left | \boldsymbol x \right | \right|_p = (\sum_{i=1}^n\left|x_i\right|^p)^{\frac{1}{p}}
  $$

  L1范数：所有分量的绝对值之和
  $$
  \left | \left | \boldsymbol x \right | \right|_1 = \sum_{i=1}^n\left|x_i\right|
  $$
  L2范数也称为向量的模，即向量的长度
  $$
  \left | \left | \boldsymbol x \right | \right|_2 = \sqrt{\sum_{i=1}^n\left|x_i\right|^2}
  $$

* 偏导与梯度

* 雅克比矩阵

* Hessian矩阵

* 泰勒公式

* 行列式

* 特征值和特征向量

* 二次型

---

* 迭代法
* 梯度下降法
* 牛顿法
* 拉格朗日乘数法
* 凸优化问题
* 拉格朗日对偶

---

概率论：

* 随机事件
* 条件概率
* 随机变量 [离散型随机变量 连续型随机变量]
* 数学期望
* 方差与标准差
* 随机向量





## 贝叶斯

* 训练数据集：模拟学习问题的输入和输出
* 决策函数集：备选决策函数集合（可行域）
* 表现度量：目标函数
* 优化算法：计算优化问题最优解
* 超参数调整：目标函数与优化算法中的超参数调整

### 最大似然估计（MLE）和最大后验估计（MAP）

* 训练数据集：模拟学习问题的输入和输出
* 决策函数集：概率模型
* 表现度量：MLE/MAP
* 优化算法：?
* 超参数调整：?



### 最大似然估计 MLE

* 训练数据集：模拟学习问题的输入和输出
* 决策函数集：p(y|x;w)
* 表现度量：

$$
\max_w{p(Y|X;w)}
$$

* 优化算法：？
* 超参数调整：？



### 贝叶斯公式

链式法则：
$$
P(X,Y) = P(X|Y)P(Y) = P(Y|X)P(X)
$$
贝叶斯规则：
$$
P(X|Y) = \frac{P(X|Y)P(X)}{P(Y)}
$$


### 最大后验估计 MAP

* 训练数据集：模拟学习问题的输入和输出
* 决策函数集：p(y|x;w)p(w)
* 表现度量：

$$
\max_w{p(Y|X;w)}p(w)
$$

* 优化算法：概率推断
* 超参数调整：？

## K-近邻分类 （KNN）

### KNN 算法简介

* KNN（k-Nearest Neighbor），也称K-近邻分类算法。分类的目的是学会一个**分类器**。该分类器能把数据映射到事先给定类别中的某一个类别。分类属于一种**监督学习**方式，分类器的学习是在被告知每一个**训练样本**属于哪个类别后进行的。每个训练样本都有一个特定的标签，与之相对应。在学习过程中，从这些给定的训练数据集中**学习一个函数**。等新的数据到来时，可以根据这个函数判断结果。

* 监督学习的训练及要求，包括**输入**和**输出**。也可以说是既有有数据的特征，也要有对应的目标，训练集中的目标是由人们事先进行标注的。

* 通过测量不同特征值之间的距离进行分类的
* 基本思路：**如果一个样本在特征空间中的k个最邻近样本中的大多数属于某一个类别，则该样本也属于这个类别**，该算法在决定类别上只依据最近的一个或几个样本的类别来决定待分类样本所属的类别，KNN算法中所选择的**邻居**都**是已经正确分类的对象**



### KNN算法大致步骤

1. 算距离：给定测试对象，计算它与训练集中的每个对象的距离；

2. 找邻居：圈定距离最近的k个训练对象，作为测试对象的近邻； 

3. 做分类：根据这k个近邻归属的**主要类别**，来对测试对象分类。



### 相似度度量方法

闵可夫斯基距离：
$$
假设数值点P和Q坐标为P(x_1,x_2,...,x_n)和Q(y_1,y_2,...,y_n)，则闵可夫斯基距离为：
$$

$$
(\sum_{i=1}^n|x_i-y_i|^p)^\frac{1}{p}
$$

* p = 1 曼哈顿距离
  $$
  \sum_{i=1}^n|x_i-y_i|
  $$

* p = 2 欧几里得距离
  $$
  \sqrt{\sum_{i=1}^n|x_i-y_i|^2}
  $$

* p = 趋向∞ 切比雪夫距离
  $$
  (\sum_{i=1}^n|x_i-y_i|^p)^\frac{1}{p} = \max_i|x_i-y_i|
  $$

### KNN一般流程

1. 计算测试数据与各个训练数据之间的距离
2. 按照距离的递增关系进行排序
3. 选取距离最小的K个点
4. 确定最小k个点所在类别的出现频率
5. 返回前K个点中出现频率最高的类别，作为测试数据的预测分类



### k的选取

k 小：分类结果容易因为噪声点的干扰而出现错误，此时方差较大

k大：偏差过大

---

### KNN算法举例

* 下方数据集中序号1-12为已知电影分类，分为喜剧片、动作片、爱情片三个种类，使用的特征值分别为搞笑镜头、打斗镜头、拥抱镜头数量。那么来了一部新电影（唐人街探案2），它属于上述电影分类中的那个类型？利用KNN是怎么做？

  ![image-20200530165605891](C:\Users\38004\AppData\Roaming\Typora\typora-user-images\image-20200530165605891.png)

  1-12为**训练集**；13为**测试集**；喜剧片、动作片、爱情片为**标签**； 搞笑镜头、打斗镜头、拥抱镜头数量为**特征值**



* **代码：**

  ```python
  #!/usr/bin/env python
  # -*- coding: utf-8 -*-
  # @Time : 2020/5/30 22:33
  # @Author : Kai
  # @File : main.py
  # @Software: PyCharm
  
  from pandas import *
  import math
  
  
  # 1. 使用字典dict构造数据集
  movie_data = {
      "宝贝当家": [45, 2, 9, "喜剧片"],
      "美人鱼": [21, 17, 5, "喜剧片"],
      "澳门风云3": [54, 9, 11, "喜剧片"],
      "功夫熊猫3": [39, 0, 31, "喜剧片"],
      "谍影重重": [5, 2, 57, "动作片"],
      "叶问3": [3, 2, 57, "动作片"],
      "伦敦陷落": [2, 3, 55, "动作片"],
      "我的特工爷爷": [6, 4, 21, "动作片"],
      "奔爱": [7, 46, 4, "爱情片"],
      "夜孔雀": [9, 39, 8, "爱情片"],
      "代理情人": [9, 38, 2, "爱情片"],
      "新步步惊心": [8, 34, 17, "爱情片"]
  }
  
  # 2. 计算新样本与数据集中所有数据的距离
  # 新样本：唐人街探案[23,3,17,”?片”]
  # 欧式距离
  x = [23, 3, 17]
  KNN = []
  for key, v in movie_data.items():
      d = math.sqrt((x[0] - v[0]) ** 2 + (x[1] - v[1]) ** 2 + (x[2] - v[2]) ** 2)
      KNN.append([key, round(d, 2)])
  print(KNN)
  
  # 3. 按照距离大小进行递增排序
  KNN.sort(key = lambda dis: dis[1])
  
  # 4. 选取距离最小的k个样本, 这里k取5
  KNN = KNN[:5]
  print(KNN)
  
  # 5. 确定前k个样本所在类别出现的频率，并输出出现频率最高的类别
  labels = {"喜剧片": 0, "动作片": 0, "爱情片": 0}
  for s in KNN:
      label = movie_data[s[0]] # 按照电影名取出movie_data中的整个电影信息
      labels[label[3]] += 1
  labels = sorted(labels.items(), key = lambda l: l[1], reverse = True)
  print(labels, labels[0][0], sep='\n')
  ```

  

* **运行结果：**

  ```
  [['宝贝当家', 23.43], ['美人鱼', 18.55], ['澳门风云3', 32.14], ['功夫熊猫3', 21.47], ['谍影重重', 43.87], ['叶问3', 44.73], ['伦敦陷落', 43.42], ['我的特工爷爷', 17.49], ['奔爱', 47.69], ['夜孔雀', 39.66], ['代理情人', 40.57], ['新步步惊心', 34.44]]
  [['我的特工爷爷', 17.49], ['美人鱼', 18.55], ['功夫熊猫3', 21.47], ['宝贝当家', 23.43], ['澳门风云3', 32.14]]
  [('喜剧片', 4), ('动作片', 1), ('爱情片', 0)]
  喜剧片
  ```

* **运行截图：**

  ![image-20200531001828873](C:\Users\38004\AppData\Roaming\Typora\typora-user-images\image-20200531001828873.png)



